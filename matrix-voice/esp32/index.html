<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ESP32 MATRIX</title>
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
  <link rel="stylesheet" href="../../css/theme.css">
  <link rel="stylesheet" href="../../css/codehilite.css">
  <link rel="stylesheet" href="../../css/superFences.css">
  <link rel="stylesheet" href="../../css/clipboard.css">
  <link rel="stylesheet" href="../../css/details.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
</head>

<body data-spy="scroll">
  <nav class="navbar navbar-expand-lg navbar-light container">
  <a class="navbar-brand" href="../..">
    <img src="../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
    <span>MATRIX</span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
  	<span class="navbar-toggler-icon"></span>
  </button>
</nav>

  <div class="header">
    <div class="container">
      <div class="jumbotron">
        <div class="row">
          <div class="col-sm-8">
            
            <h1>ESP32</h1>
            
          </div>
          <div class="col-sm-4">
            <form action="../../search.html" method="get">
              <input class="form-control" type="search" name="q" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="content">
    <div class="container">
      <div class="row">
        <div class="sidebar col-lg-2">
          <div class="collapse navbar-collapse" id="navbar-menu">
            <h3>Documentation</h3>
            <ul>
                

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../.." class="">
    Overview
  </a>
</li>


  

<!-- link to depth-first url found  -->
  

<!-- If there are no children, use the url (simple)  -->
<li>
  <a href="../../help/" class="">
    Support
  </a>
</li>


  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../matrix-creator/overview/" class="">
    MATRIX Creator
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-creator/overview/" class="">Overview</a></li>
     
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-creator/device-setup/" class="">Device Setup</a></li>
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-creator/resources/overview/" class="">
      Resources
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-creator/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../overview/" class="active">
    MATRIX Voice
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../overview/" class="">Overview</a></li>
     
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../device-setup/" class="">Device Setup</a></li>
     
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="./" class="active">ESP32</a></li>
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../resources/overview/" class="">
      Resources
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../matrix-lite/overview/" class="">
    MATRIX Lite
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-lite/overview/" class="">Overview</a></li>
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-lite/getting-started/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-lite/js-reference/" class="">
      JavaScript Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-lite/py-reference/" class="">
      Python Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-lite/go-reference/" class="">
      Go Reference
    </a>
  </li>

  <ul class="subnav">
        
        
        
      
  </ul>

   
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../matrix-hal/overview/" class="">
    MATRIX HAL
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-hal/overview/" class="">Overview</a></li>
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-hal/getting-started/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-hal/reference/" class="">
      References
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-hal/examples/" class="">
      Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-hal/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

  


<!-- Children complicate things  -->

<!-- link to depth-first url found  -->
  

<!-- print root node  -->
<li class="">
  <a href="../../matrix-core/overview/" class="">
    MATRIX Core
  </a>
</li>

<ul class="subnav">
   
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-core/overview/" class="">Overview</a></li>
     
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-core/getting-started/" class="">
      Getting Started
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-core/protocols/" class="">
      Driver Protocols
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-core/javascript-examples/" class="">
      Javascript Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- 2 deep  -->
  <!-- print subroot  -->
  <li>
    <a href="../../matrix-core/python-examples/" class="">
      Python Examples
    </a>
  </li>

  <ul class="subnav">
        
        
        
        
        
        
        
      
  </ul>

    
  <!-- only 1 deep, print menu items  -->
   
  <li><a href="../../matrix-core/troubleshooting/" class="">Troubleshooting</a></li>
    
</ul>

 
              <!-- <li><a target="_blank" href="https://www.hackster.io/matrix-labs">Projects</a></li> -->
            </ul>
          </div>
        </div>
        <div id="content" class="col-lg-8 col-md-9 md-typeset">
           <h2 id="esp32-setup">ESP32 Setup</h2>
<p>This guide will show you how to program the Matrix Voice's ESP32 with Visual Studio Code using PlatformIO, an open source ecosystem for IoT development.</p>
<p><img alt="" src="../img/pio_intro.jpg" /></p>
<p><br></p>
<h2 id="step-1-raspberry-pi-setup">Step 1: Raspberry Pi Setup</h2>
<p>Run the following commands inside your Raspberry Pi terminal to install the MATRIX Voice Software. This will keep the FPGA firmware updated and install a few tools to flash the ESP-WROOM-32.</p>
<p>Add the MATRIX repository and key.
<div class="codehilite"><pre><span></span>curl https://apt.matrix.one/doc/apt-key.gpg <span class="p">|</span> sudo apt-key add -
<span class="nb">echo</span> <span class="s2">&quot;deb https://apt.matrix.one/raspbian </span><span class="k">$(</span>lsb_release -sc<span class="k">)</span><span class="s2"> main&quot;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/matrixlabs.list
</pre></div></p>
<p>Update your repository and packages.
<div class="codehilite"><pre><span></span>sudo apt-get update
sudo apt-get upgrade
</pre></div></p>
<p>Install the MATRIX init package.
<div class="codehilite"><pre><span></span>sudo apt install matrixio-creator-init
</pre></div></p>
<p>Reboot your Raspberry Pi.
<div class="codehilite"><pre><span></span>sudo reboot
</pre></div></p>
<p>SSH back into your Raspberry Pi and enable the ESP32 communications.
<div class="codehilite"><pre><span></span>sudo voice_esp32_enable
</pre></div></p>
<p>Reset the ESP32 flash memory.
<div class="codehilite"><pre><span></span>esptool.py --chip esp32 --port /dev/ttyS0 --baud <span class="m">115200</span> --before default_reset --after hard_reset erase_flash
</pre></div></p>
<p><br></p>
<h2 id="step-2-personal-computer-setup">Step 2: Personal Computer Setup</h2>
<p>Here we're installing the requirements needed to allow your PC to develop and compile ESP32 projects.</p>
<ul>
<li><a href="https://git-scm.com/downloads">Git</a> : Version control tool.</li>
<li><a href="https://code.visualstudio.com/">Visual Studio Code</a> : Powerful text editor.</li>
<li><a href="https://platformio.org/">PlatformIO</a> : Development ecosystem with Espressif IDF preinstalled.</li>
<li><a href="https://docs.platformio.org/en/latest/installation.html#install-shell-commands">Add PlatformIO to your PATH</a>.</li>
</ul>
<p>Once you have completed the above items, run the following command to clone the PlatformIO project.</p>
<div class="codehilite"><pre><span></span>git clone https://github.com/matrix-io/esp32-platformio
</pre></div>

<p><br></p>
<h2 id="step-3-configure-ota-over-the-air-deployment">Step 3: Configure OTA (Over The Air) Deployment</h2>
<p>Open Visual Studio Code and open the PlatformIO home hub. </p>
<p><img alt="" src="../img/pio_home.png" /></p>
<p>Click on <code>Open Project</code> and select the <code>esp32-platformio</code> folder. </p>
<p><img alt="" src="../img/pio_open.png" /></p>
<p>Once inside the <code>esp32-platformio</code> folder open <code>platformio.ini</code>.</p>
<p>The example code in the initial <code>src/main.cpp</code> file uses OTA updates to easily redeploy code to the ESP32.</p>
<p>To enable OTA updates, make sure to change the <code>SSID_GOES_HERE</code> and <code>PASSWORD_GOES_HERE</code> to your actual WiFi SSID and password.</p>
<p><img alt="" src="../img/pio_ini.png" /></p>
<details class="bug" open="open"><summary>For Windows Users</summary><p>If you are using Windows, replace the <code>upload_port</code> parameter inside <code>platformio.ini</code> with the IP of your MATRIX VOICE ESP32.</p>
<p>For example, if your IP is <code>192.168.1.1</code> then change
<div class="codehilite"><pre><span></span><span class="n">upload_port</span> <span class="o">=</span> <span class="s1">&#39;MVESP.local&#39;</span>
</pre></div>
to
<div class="codehilite"><pre><span></span><span class="n">upload_port</span> <span class="o">=</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">1</span>
</pre></div></p>
</details>
<p><br></p>
<h2 id="step-4-initial-build-and-deploy">Step 4: Initial Build and Deploy</h2>
<p>To compile the code, click on the button with the check mark on the bottom left corner of Visual Studio Code. This will build and compile the code to <code>.pio/build/lolin32/firmware.bin</code> in the <code>esp32-platformio</code> directory.</p>
<div class="admonition tip">
<p class="admonition-title">Alternatively you can use the <code>pio run</code> command while in the <code>esp32-platformio</code> directory.</p>
</div>
<p><img alt="" src="../img/pio_run.png" /></p>
<p>To deploy the compiled firmware run the commands below. Replace <code>YOUR_PI_IP_HERE</code> with the IP of your Raspberry Pi. If you are running Windows please use <code>Git Bash</code> as your terminal for the following commands.</p>
<div class="codehilite"><pre><span></span><span class="nb">cd</span> esp32-platformio/ota
./install.sh YOUR_PI_IP_HERE
</pre></div>

<p><br></p>
<h2 id="step-5-deploying-after-initial-upload">Step 5: Deploying After Initial Upload</h2>
<p>After the initial upload, all successive uploads can be done through OTA or through the <code>install.sh</code> script above. 
To upload using OTA, open a terminal, go into the project directory, and run this command.</p>
<div class="codehilite"><pre><span></span>pio run --target upload
</pre></div>

<p><br></p>
<h2 id="finishing-up">Finishing Up</h2>
<p><img alt="" src="../img/pio_example.gif" /></p>
<p>Your MATRIX Voice ESP32 should now be running the deployed example shown above. With the program properly flashed in the ESP32, the Voice can now run without the Pi if you choose to do so. Ensure the MATRIX Voice and Pi are not powered before connecting or disconnecting.</p>
<p>The deployed code can be found in the <code>src/main.cpp</code> file inside the <code>esp32-platformio</code> directory.</p>
<p>More examples can be found <a href="https://github.com/matrix-io/matrixio_hal_esp32/tree/master/examples">here</a>.</p>
<p><br></p>
<h2 id="helpful-information">Helpful Information</h2>
<details class="info"><summary>Updating PlatformIO Libraries</summary><p>To update PlatformIO and PlatformIO libraries run the following commands.</p>
<div class="codehilite"><pre><span></span>pio update
pio lib update
</pre></div>

</details>
<details class="info"><summary>Connecting to the ESP32 UART from Raspberry Pi</summary><p>To read the serial output from the ESP32 using <code>minicom</code> the MATRIX VOICE ESP32 must be connected to the Pi.</p>
<p>First install <code>minicom</code> on your Raspberry Pi.</p>
<div class="codehilite"><pre><span></span>sudo apt install minicom
</pre></div>

<p>Then to connect and read from serial run the following command.</p>
<div class="codehilite"><pre><span></span>sudo minicom -D /dev/ttyS0
</pre></div>

<p>To close minicom press <code>Ctrl+A</code> then <code>X</code>.</p>
</details>
<p><br></p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If the <code>pio run --target upload</code> command does not work please check the <code>MVID</code> parameter inside <code>platformio.ini</code>, it should have a maximum length of 8 characters. </p>
<p>If <code>pio run --target upload</code> still does not work try running the below command instead, replacing <code>'MVESP.local'</code> with the data from the <code>upload_port</code> parameter inside <code>platformio.ini</code>.</p>
<div class="codehilite"><pre><span></span>~/.platformio/packages/framework-arduinoespressif32/tools/espota.py --port<span class="o">=</span><span class="m">3232</span> --auth<span class="o">=</span>voice --debug --progress -i <span class="s1">&#39;MVESP.local&#39;</span> -f .pio/build/esp32dev/firmware.bin
</pre></div>

<p>If you encounter issues with building try removing build files, reinstalling libraries, and rebuilding project with the following commands.</p>
<div class="codehilite"><pre><span></span>pio run -t clean <span class="o">&amp;&amp;</span> rm -r .pio
pio run
</pre></div> 
        </div>
        <div class="toc-parent col-lg-2 col-md-3">
          <div class="toc">
            
            <h3>Contents</h3>
            <ul class="nav flex-column">
               <li class='nav-item'>
  <a href="#esp32-setup" class="nav-link active">
    ESP32 Setup
  </a>
  
</li>  <li class='nav-item'>
  <a href="#step-1-raspberry-pi-setup" class="nav-link ">
    Step 1: Raspberry Pi Setup
  </a>
  
</li>  <li class='nav-item'>
  <a href="#step-2-personal-computer-setup" class="nav-link ">
    Step 2: Personal Computer Setup
  </a>
  
</li>  <li class='nav-item'>
  <a href="#step-3-configure-ota-over-the-air-deployment" class="nav-link ">
    Step 3: Configure OTA (Over The Air) Deployment
  </a>
  
</li>  <li class='nav-item'>
  <a href="#step-4-initial-build-and-deploy" class="nav-link ">
    Step 4: Initial Build and Deploy
  </a>
  
</li>  <li class='nav-item'>
  <a href="#step-5-deploying-after-initial-upload" class="nav-link ">
    Step 5: Deploying After Initial Upload
  </a>
  
</li>  <li class='nav-item'>
  <a href="#finishing-up" class="nav-link ">
    Finishing Up
  </a>
  
</li>  <li class='nav-item'>
  <a href="#helpful-information" class="nav-link ">
    Helpful Information
  </a>
  
</li>  <li class='nav-item'>
  <a href="#troubleshooting" class="nav-link ">
    Troubleshooting
  </a>
  
</li> 
            </ul>
          </div>
        </div>
        
      </div>
    </div>
  </div>

  <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <div class="row">
          <div class="col-sm-4">
            <h5>MATRIX</h5>
            <ul>
              <li>
                <a href="https://matrix.one/products/creator" target="_blank">Creator</a>
              </li>
              <li>
                <a href="https://matrix.one/products/voice" target="_blank">Voice</a>
              </li>
              <li>
                <a href="http://community.matrix.one/" target="_blank">Community</a>
              </li>
            </ul>
          </div>
          <div class="col-sm-4">
            <h5>Learn</h5>
            <ul>
              <li>
                <a href="https://www.matrix.one/educators" target="_blank">Educators</a>
              </li>
              <li>
                <a href="https://www.matrix.one/developers" target="_blank">Developers</a>
              </li>
              <li>
                <a href="https://www.matrix.one/resources" target="_blank">Resources</a>
              </li>
            </ul>
          </div>
          <div class="col-sm-4">
            <h5>Social Network</h5>
            <ul>
              <li>
                <a href="https://www.facebook.com/MATRIXCreator" target="_blank">Facebook</a>
              </li>
              <li>
                <a href="https://twitter.com/matrix_creator" target="_blank">Twitter</a>
              </li>
              <li>
                <a href="https://www.youtube.com/channel/UCBIqR8r0tfY6W-4-YpZ7NeQ" target="_blank">YouTube</a>
              </li>
              <li>
                <a href="https://www.instagram.com/matrix_creator/" target="_blank">Instagram</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <h5>Contact</h5>
        <ul>
          <li>
            <a href="https://matrix.one/contact">Contact Us</a>
          </li>
          <li class="subscribe-box">
            <form id="newsletter-form">
              <div class="input-group">
                <input id="newsletter-email" type="email" class="form-control" placeholder="Subscribe for Updates">
                <button type="submit" class="btn btn-success">Subscribe</button>
              </div>
              <label for="newsletter-email"></label>
            </form>
          </li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <a href="https://creator.matrix.one" class="company-logo">
          <img src="../../img/everloop.png" width="38" height="38" class="d-inline-block align-top" alt="">
          <span>MATRIX</span>
        </a>
        <small class="copyright">
          2019 &copy; MATRIX - All rights reserved
        </small>
      </div>
      <div class="col-sm-6">
        <div class="utility-links">
          <a href="https://matrix.one/policies/terms">Terms of Service</a>
          <a href="https://matrix.one/policies/privacy">Privacy Policy</a>
          <a href="https://matrix.one/policies/cookie">Cookie Policy</a>
        </div>
      </div>
    </div>
  </div>
</footer>
  <!--Global Vars-->
  <script>
    base_url = "../..";
  </script>
  <!-- Scripts -->
  <script src="../../js/clipboard.min.js"></script>
  <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
  <script src="../../js/theme.js"></script>
  <script src="https://use.fontawesome.com/21aeb6fedc.js"></script>
  <script src="../../js/jquery.ajaxchimp.min.js"></script>
  <script src="../../js/jquery.ajaxchimp.langs.min.js"></script>
  <script src="../../js/footer.js"></script>

  <!-- TOC Script -->
  <script>
    jQuery(function($) {
      $('.toc-parent ul li a').on('click', function() {
        var removedElement = $(this)
          .closest('.toc-parent ul li')
          .find('a.active')
          .removeClass('active');

        if (removedElement.length == 0) {
          $('.toc-parent ul li').find('a.active').removeClass('active');
        }

        $(this).addClass('active');
      });
    });
  </script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-38180903-26', 'auto');
    ga('send', 'pageview');
  </script>
  
</body>

</html>